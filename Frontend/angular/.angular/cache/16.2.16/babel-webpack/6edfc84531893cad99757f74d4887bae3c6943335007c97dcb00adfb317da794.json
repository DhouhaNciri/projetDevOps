{"ast":null,"code":"import Swal from 'sweetalert2';\nimport { AddHousingComponent } from '../add-housing/add-housing.component';\nimport { DetailsComponent } from './details/details.component';\nimport { EditPublicationComponent } from './edit-publication/edit-publication.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"../services/housing.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/input\";\nimport * as i8 from \"@angular/material/form-field\";\nimport * as i9 from \"@angular/material/icon\";\nfunction PublicationComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function PublicationComponent_div_8_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.openDialog());\n    });\n    i0.ɵɵtext(2, \"+ annonce \");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PublicationComponent_div_32_li_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const amenity_r8 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(amenity_r8);\n  }\n}\nfunction PublicationComponent_div_32_button_33_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 30);\n    i0.ɵɵlistener(\"click\", function PublicationComponent_div_32_button_33_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const housing_r4 = i0.ɵɵnextContext().$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.delete(housing_r4.id));\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"delete\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PublicationComponent_div_32_button_34_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function PublicationComponent_div_32_button_34_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const housing_r4 = i0.ɵɵnextContext().$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.edit(housing_r4));\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"edit\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PublicationComponent_div_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"div\", 19);\n    i0.ɵɵelement(2, \"img\", 20);\n    i0.ɵɵelementStart(3, \"div\", 21)(4, \"h5\", 22);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 23);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\")(9, \"strong\");\n    i0.ɵɵtext(10, \"Price:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"p\")(13, \"strong\");\n    i0.ɵɵtext(14, \"Availability:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"p\")(17, \"strong\");\n    i0.ɵɵtext(18, \"Available Rooms:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"p\")(21, \"strong\");\n    i0.ɵɵtext(22, \"Amenities:\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(23, \"ul\");\n    i0.ɵɵtemplate(24, PublicationComponent_div_32_li_24_Template, 2, 1, \"li\", 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"p\")(26, \"strong\");\n    i0.ɵɵtext(27, \"Characteristics:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"div\", 25)(30, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function PublicationComponent_div_32_Template_button_click_30_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const housing_r4 = restoredCtx.$implicit;\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.show(housing_r4));\n    });\n    i0.ɵɵelementStart(31, \"mat-icon\");\n    i0.ɵɵtext(32, \"visibility\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(33, PublicationComponent_div_32_button_33_Template, 3, 0, \"button\", 27);\n    i0.ɵɵtemplate(34, PublicationComponent_div_32_button_34_Template, 3, 0, \"button\", 28);\n    i0.ɵɵelementStart(35, \"button\", 29);\n    i0.ɵɵlistener(\"click\", function PublicationComponent_div_32_Template_button_click_35_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const housing_r4 = restoredCtx.$implicit;\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.openMessaging(housing_r4));\n    });\n    i0.ɵɵelementStart(36, \"mat-icon\");\n    i0.ɵɵtext(37, \"message\");\n    i0.ɵɵelementEnd()()()()()();\n  }\n  if (rf & 2) {\n    const housing_r4 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"src\", housing_r4.photos[0], i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(housing_r4.address);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(housing_r4.description);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" $\", housing_r4.price, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", housing_r4.availability ? \"Available\" : \"Not Available\", \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", housing_r4.availableRooms, \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", housing_r4.amenities);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", housing_r4.characteristics, \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", housing_r4.createdBy.email == ctx_r1.email);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", housing_r4.createdBy.email == ctx_r1.email);\n  }\n}\nexport let PublicationComponent = /*#__PURE__*/(() => {\n  class PublicationComponent {\n    constructor(dialog, HousingService, router) {\n      this.dialog = dialog;\n      this.HousingService = HousingService;\n      this.router = router;\n      this.tenantConnect = localStorage.getItem('tenant');\n      this.ownerConnect = localStorage.getItem('owner');\n      this.adminConnect = localStorage.getItem('admin');\n      this.email = localStorage.getItem('email');\n      this.housings = [];\n      this.filteredHousings = [];\n      // Filter variables\n      this.searchQuery = '';\n      this.filterPrice = null;\n      this.filterAvailableRooms = null;\n      this.filterAddress = '';\n      this.filterCharacteristics = ''; // New filter variable\n      this.housingCount = '';\n    }\n    ngOnInit() {\n      this.getAllHousing();\n      this.getHousingCount();\n    }\n    getHousingCount() {\n      this.HousingService.countHousing().subscribe(count => {\n        this.housingCount = count;\n      }, error => {\n        console.error('Failed to fetch housing count:', error);\n      });\n    }\n    getAllHousing() {\n      this.HousingService.getAllHousing().subscribe(res => {\n        console.log(res);\n        this.housings = res;\n        this.filteredHousings = res;\n      });\n    }\n    // Apply filters\n    applyFilters() {\n      this.filteredHousings = this.housings.filter(housing => {\n        const matchesPrice = this.filterPrice ? housing.price <= this.filterPrice : true;\n        const matchesRooms = this.filterAvailableRooms ? housing.availableRooms >= this.filterAvailableRooms : true;\n        const matchesAddress = this.filterAddress ? housing.address.toLowerCase().includes(this.filterAddress.toLowerCase()) : true;\n        const matchesSearch = housing.description.toLowerCase().includes(this.searchQuery.toLowerCase()) || housing.address.toLowerCase().includes(this.searchQuery.toLowerCase());\n        const matchesCharacteristics = this.filterCharacteristics ? housing.characteristics.toLowerCase().includes(this.filterCharacteristics.toLowerCase()) : true;\n        return matchesPrice && matchesRooms && matchesAddress && matchesSearch && matchesCharacteristics;\n      });\n    }\n    onFilterChange() {\n      this.applyFilters();\n    }\n    openDialog() {\n      const dialogRef = this.dialog.open(AddHousingComponent);\n      dialogRef.afterClosed().subscribe(() => {\n        this.getAllHousing();\n      });\n    }\n    show(data) {\n      const dialogRef = this.dialog.open(DetailsComponent, {\n        data\n      });\n      dialogRef.afterClosed().subscribe(() => {\n        this.getAllHousing();\n      });\n    }\n    edit(data) {\n      const dialogRef = this.dialog.open(EditPublicationComponent, {\n        data\n      });\n      dialogRef.afterClosed().subscribe(() => {\n        this.getAllHousing();\n      });\n    }\n    delete(id) {\n      Swal.fire({\n        title: \"Are you sure?\",\n        text: \"You won't be able to revert this!\",\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonColor: \"#3085d6\",\n        cancelButtonColor: \"#d33\",\n        confirmButtonText: \"Yes, delete it!\"\n      }).then(result => {\n        if (result.isConfirmed) {\n          this.HousingService.deleteHousing(id).subscribe(() => {\n            Swal.fire({\n              title: \"Deleted!\",\n              text: \"Your housing listing has been deleted.\",\n              icon: \"success\"\n            }).then(() => {\n              this.getAllHousing();\n            });\n          });\n        }\n      });\n    }\n    openMessaging(housing) {\n      // Navigate to the chat page, passing the housing information or the necessary parameters as needed\n      this.router.navigate(['/chat'], {\n        queryParams: {\n          userId: housing.createdBy.id\n        }\n      });\n    }\n    static #_ = this.ɵfac = function PublicationComponent_Factory(t) {\n      return new (t || PublicationComponent)(i0.ɵɵdirectiveInject(i1.MatDialog), i0.ɵɵdirectiveInject(i2.HousingService), i0.ɵɵdirectiveInject(i3.Router));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: PublicationComponent,\n      selectors: [[\"app-publication\"]],\n      decls: 33,\n      vars: 7,\n      consts: [[\"id\", \"publication\", 1, \"explore\", 2, \"margin-top\", \"100px\"], [1, \"container\"], [2, \"display\", \"flex\", \"justify-content\", \"space-between\"], [1, \"section-header\"], [\"style\", \"margin-right: 60px; margin-top: 10px;\", 4, \"ngIf\"], [2, \"margin-bottom\", \"20px\"], [\"appearance\", \"fill\", 2, \"width\", \"200px\", \"margin-right\", \"10px\"], [\"matInput\", \"\", \"placeholder\", \"Search by address or description\", 3, \"ngModel\", \"ngModelChange\"], [\"appearance\", \"fill\", 2, \"width\", \"150px\", \"margin-right\", \"10px\"], [\"matInput\", \"\", \"type\", \"number\", \"placeholder\", \"Price\", 3, \"ngModel\", \"ngModelChange\"], [\"matInput\", \"\", \"type\", \"number\", \"placeholder\", \"Rooms\", 3, \"ngModel\", \"ngModelChange\"], [\"matInput\", \"\", \"placeholder\", \"Filter by address\", 3, \"ngModel\", \"ngModelChange\"], [\"matInput\", \"\", \"placeholder\", \"Filter by characteristics\", 3, \"ngModel\", \"ngModelChange\"], [1, \"explore-content\"], [1, \"row\"], [\"class\", \"col-md-4\", \"style\", \"margin-top: 5px; margin-bottom: 5px;\", 4, \"ngFor\", \"ngForOf\"], [2, \"margin-right\", \"60px\", \"margin-top\", \"10px\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"col-md-4\", 2, \"margin-top\", \"5px\", \"margin-bottom\", \"5px\"], [1, \"card\", 2, \"width\", \"18rem\", \"height\", \"auto\"], [\"alt\", \"Housing Image\", 1, \"card-img-top\", 3, \"src\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"card-text\"], [4, \"ngFor\", \"ngForOf\"], [1, \"d-flex\", \"justify-content-between\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", 3, \"click\"], [\"mat-mini-fab\", \"\", \"style\", \"background-color: red;\", 3, \"click\", 4, \"ngIf\"], [\"mat-mini-fab\", \"\", \"style\", \"background-color: rgb(1, 156, 156);\", 3, \"click\", 4, \"ngIf\"], [\"mat-mini-fab\", \"\", 2, \"background-color\", \"#3f51b5\", 3, \"click\"], [\"mat-mini-fab\", \"\", 2, \"background-color\", \"red\", 3, \"click\"], [\"mat-mini-fab\", \"\", 2, \"background-color\", \"rgb(1, 156, 156)\", 3, \"click\"]],\n      template: function PublicationComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"h2\");\n          i0.ɵɵtext(5, \"Publication\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"p\");\n          i0.ɵɵtext(7, \"Explore Collection, the world, and many more\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(8, PublicationComponent_div_8_Template, 3, 0, \"div\", 4);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"div\", 5)(10, \"mat-form-field\", 6)(11, \"mat-label\");\n          i0.ɵɵtext(12, \"Search\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(13, \"input\", 7);\n          i0.ɵɵlistener(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_13_listener($event) {\n            return ctx.searchQuery = $event;\n          })(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_13_listener() {\n            return ctx.onFilterChange();\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(14, \"mat-form-field\", 8)(15, \"mat-label\");\n          i0.ɵɵtext(16, \"Max Price\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(17, \"input\", 9);\n          i0.ɵɵlistener(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_17_listener($event) {\n            return ctx.filterPrice = $event;\n          })(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_17_listener() {\n            return ctx.onFilterChange();\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"mat-form-field\", 6)(19, \"mat-label\");\n          i0.ɵɵtext(20, \"Available Rooms\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"input\", 10);\n          i0.ɵɵlistener(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_21_listener($event) {\n            return ctx.filterAvailableRooms = $event;\n          })(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_21_listener() {\n            return ctx.onFilterChange();\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(22, \"mat-form-field\", 6)(23, \"mat-label\");\n          i0.ɵɵtext(24, \"Address\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"input\", 11);\n          i0.ɵɵlistener(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_25_listener($event) {\n            return ctx.filterAddress = $event;\n          })(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_25_listener() {\n            return ctx.onFilterChange();\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(26, \"mat-form-field\", 6)(27, \"mat-label\");\n          i0.ɵɵtext(28, \"Characteristics ( crit\\u00E8res des colocataires )\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"input\", 12);\n          i0.ɵɵlistener(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_29_listener($event) {\n            return ctx.filterCharacteristics = $event;\n          })(\"ngModelChange\", function PublicationComponent_Template_input_ngModelChange_29_listener() {\n            return ctx.onFilterChange();\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(30, \"div\", 13)(31, \"div\", 14);\n          i0.ɵɵtemplate(32, PublicationComponent_div_32_Template, 38, 10, \"div\", 15);\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"ngIf\", ctx.tenantConnect || ctx.adminConnect || ctx.ownerConnect);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngModel\", ctx.searchQuery);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.filterPrice);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.filterAvailableRooms);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.filterAddress);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.filterCharacteristics);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngForOf\", ctx.filteredHousings);\n        }\n      },\n      dependencies: [i4.NgForOf, i4.NgIf, i5.DefaultValueAccessor, i5.NumberValueAccessor, i5.NgControlStatus, i5.NgModel, i6.MatButton, i6.MatMiniFabButton, i7.MatInput, i8.MatFormField, i8.MatLabel, i9.MatIcon],\n      styles: [\".text-success[_ngcontent-%COMP%]{color:green;font-weight:700}.text-danger[_ngcontent-%COMP%]{color:red;font-weight:700}\"]\n    });\n  }\n  return PublicationComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}